# プロダクト要求定義書 (PRD)

## プロダクトビジョン

### 概要

DCP Ops Monitor は、確定拠出年金（Defined Contribution Plan）の運用状況を自動で監視・蓄積するシステムです。平日に資産情報を取得・保存し、運用管理負荷を軽減します。

### 目的

- **運用状況の可視化**: 確定拠出年金の資産情報を定期的に取得し、S3 に蓄積
- **管理負荷の軽減**: 手動でのログイン・確認作業を自動化
- **異常の早期検知**: エラー発生時に即座に通知し、迅速な対応を可能にする

### スコープ

**対象**:
- 確定拠出年金の資産情報取得・保存
- エラー発生時の通知

**対象外**:
- 運用商品の購入・売却などの操作
- 複数ユーザーの管理
- 運用アドバイス・推奨機能
- 運用サマリの通知（将来的に別機能として実装予定）

---

## 機能要件

### 資産情報収集機能

平日に確定拠出年金の資産情報を取得し、S3 に保存します。

- 平日（月〜金）09:00 (JST) に自動実行される
- 認証を行い、資産評価情報を取得する
- 総評価額（拠出金額累計、評価損益、資産評価額）を取得する
- 商品別の資産情報を取得する
- 資産情報を JSON 形式で S3 に保存する（`assets/{YYYY}/{MM}/{DD}.json`）
- スクレイピング失敗時はエラーアーティファクト（スクリーンショット/HTML）を S3 に保存する（`errors/`）

### エラー通知機能

運用状況の取得処理でエラーが発生した場合、自動的に通知します。

- ERROR レベルのログを自動検知する
- 検知後、エラー通知処理をトリガーする
- エラーメッセージ、発生時刻 (JST)、例外名を含む通知を送信する
- 詳細ログへのリンクを含む
- スクリーンショットがある場合は添付する
- エラー発生時にスクリーンショットを保存する
- 抽出失敗時に HTML を保存する
- ログにファイルパスを記録する

---

## 非機能要件

### パフォーマンス

### セキュリティ

### 可用性

### 保守性

### 拡張性

- 設計上、他の通知先への拡張が可能である
- スケジュールは設定変更で対応可能である

---

## 制約事項

### 技術的制約

- 対象 Web サイトの構造変更により、処理の修正が必要になる可能性がある

### 前提条件

- 対象の確定拠出年金 Web サイトが稼働していること
- 通知先のアカウントが設定済みであること

---

## 用語集

| 用語 | 説明 |
|------|------|
| DCP | Defined Contribution Plan（確定拠出年金） |
| 拠出金額累計 | これまでに拠出した金額の合計 |
| 評価損益 | 現在の評価額と拠出金額累計の差額 |
| 資産評価額 | 現在の資産の評価額 |
