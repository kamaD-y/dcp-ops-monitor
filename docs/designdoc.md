# Design Document

## Overview
本システムは、確定拠出年金の運用状況を通知します。
現在の運用状況をサマリし通知することで、将来の受給目標に対して順調に推移しているかを把握し、
運用商品の乗り換えが必要かどうか判断する材料とします。

## Context
対象の運用ページを参照すれば、より詳細な情報が取得できますが
定期的にページを参照することは面倒かつ忘れてしまう為、定期的に自動で運用状況を通知します。

## Scope
運用者である自身及び、AI コーディングエージェントの為。

## Goal
手戻りがなく想定した通りの成果物を実現する。

## Non-Goal
運用商品の乗り換えは必要に応じて手動で対応します。

## Solution / Technical Architecture

- スクレイピング Lambda

  1. 対象ページをスクレイピング・ HTML データ抽出処理
  2. HTML データ加工処理
  3. 結果を通知

- スクレイピング Lambda エラーハンドリング

  1. スクレイピング時のエラー
    エラーページを HTML 形式で S3 に保存する
    エラーメッセージサンプル: `xxx ページの抽出処理でエラーが発生しました。エラーページ詳細は s3://xxx.html をご確認下さい`
  2. HTML データ加工処理時のエラー
    エラーメッセージサンプル: `xxx ページの加工処理でエラーが発生しました。エラーページ詳細は s3://xxx.html をご確認下さい`
  3. 結果通知処理時のエラー
    エラーメッセージサンプル: `xxx への通知送信処理でエラーが発生しました。エラー詳細は xxx です`

- 結果通知

  1. 成功時
    スクレイピング Lambda から SNS Topic (Success) へ送信
  2. 失敗時
    CloudWatch Logs に出力されたログを SNS Topic (Failed) へ送信
    SNS から受信した Event から対象のエラーログメッセージを取得する (https://qiita.com/onooooo/items/f59c69e30dc5b477f9fd)

- 結果通知 Lambda

  1. SNS Topic (Success/Failed) からトリガー・バリデーション
  2. Message Event を LINE に通知

- 結果通知 Lambda エラーハンドリング
  1. バリデーションエラー
    エラーメッセージサンプル: `バリデーションエラー。xxx が正しい形式ではありません`
  2. 結果通知処理時のエラー
    エラーメッセージサンプル: `xxx への通知送信処理でエラーが発生しました。エラー詳細は xxx です`

### System Context Diagrams
